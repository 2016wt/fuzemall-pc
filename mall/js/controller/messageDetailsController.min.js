/*! touch 2016-11-04 */
define(function(){return function(a,b){$("#container").loadPage(a,["css/messageDetails.css"],function(){var a=$("#issueReplyIptTem").html();Serve.getIssueDetails({question_id:b.id},function(b){function c(a){j.each(function(){return 0===this.height?(k=!1,!1):void 0}),k?(clearTimeout(i),a()):(k=!0,i=setTimeout(function(){c(a)},500))}if(200==b.code){$(".md-details-load").hide();for(var d=0;d<b.list.length;d++){for(var e=b.list[d].pic,f=[],g=0;g<e.length;g++){var h={path:""};h.path=e[g],f[g]=h}b.list[d].pic=f}$("#issueTag").html($("#issueTagTem").tmpl(b.list[0])),$("#issueDetails").html($("#issueDetailsTem").tmpl(b.list[0])),$("#issueReply").html($("#issueReplyTem").tmpl(b)),2==b.list[0].is_solve&&$("#issueReply").find(".md-reply").last().append(a);var i,j=$(".md-imgID").find("img"),k=!0;c(function(){for(var a=j.size(),b=0;a>b;b++){var c=j.eq(b).width(),d=j.eq(b).height();if(c>d){j.eq(b).width("100%");var e=(j.eq(b).parent().height()-j.eq(b).height())/2;j.eq(b).css({"margin-top":e+"px"})}else j.eq(b).height("100%")}})}}),$(".md-details-con").on("click","#askPost",function(){var a=$(this).siblings(".md-ask-con").find("input").val();Serve.addIssue({question_id:b.id,question:a},function(a){if(200==a.code){var b='<!-- 追问 --><div class="md-message-con"><p class="md-message-tit">追问：</p><div class="md-message-text"><p>'+a.question+"</p></div>";$("#issueReply").append(b),$("#askCancel").trigger("click")}})}),$("#messageScore").on("click","#md-score-ok",function(){var a=$("#messageScore").find(".star").size();Serve.messageScore({question_id:b.id,score:a},function(a){200==a.code&&($.alertTmpMsg("评分成功！"),$("#messageScore,#md-reply-box").hide(),window.location.reload())})}),$(".md-imgID").on("click",".imgBox",function(){var a=$(this),b=a.find("img"),c=b.attr("src"),d=b.width(),e=b.height(),f=document.documentElement.clientWidth||document.body.clientWidth||document.body.scrollWidth,g=document.documentElement.clientHeight||document.body.clientHeight||document.body.scrollHeight;if($(".imgFixed").show(),$(".imgFixed").find("img").attr("src",c),d>e){$(".imgFixed").find("img").css({height:"auto",width:.8*f});var h=(g-$(".imgFixed").find("img").height())/2;$(".imgFixed").find("img").css({"margin-top":h+"px"})}else $(".imgFixed").find("img").css({width:"auto",height:.8*g,"margin-top":.1*g})}),$(".imgFixed").on("click",".imgFixedClose",function(){$(".imgFixed").hide(),$(".imgFixed").find("img").attr("src","")}),$(".md-details-con").on("click","#askAgain",function(){var a=$(this),b=a.parent().find(".JS_btn"),c=a.next();b.hide(20,function(){c.slideDown(300)})}),$(".md-details-con").on("click","#askCancel",function(){var a=$(this),b=a.parents(".md-btnBox").find(".JS_btn"),c=a.parent(".md-askBox");c.slideUp(300,function(){b.show(20)})}),$(".md-details-con").on("click","#askResolved",function(){var a=$("#messageScore");a.show(),$("html,body").animate({scrollTop:0},300)}),$("#messageScore").on("click","img",function(){var a=$(this),b=$("#messageScore").find("img"),c=b.index(a),d="./img/score-star.png",e="./img/score-star-choo.png";b.attr("src",d).removeClass("star");for(var f=0;c>=f;f++)b.eq(f).attr("src",e).addClass("star")}),$("#messageScore").on("click","#md-score-cancel",function(){var a=$("#messageScore"),b=a.find("img"),c="./img/score-star.png",d="./img/score-star-choo.png";b.attr("src",c),b.eq(0).attr("src",d).addClass("star"),a.hide()}),$(document).on("click",function(a){var b=$(a.target),c=$("#messageScore");!c.is(":visible")||b.parents().hasClass("md-score")||b.hasClass("md-score")||b.is("#askResolved")||$("#md-score-cancel").trigger("click")})})}});