/*! touch 2016-11-04 */
define(function(){return function(a,b){$("#container").loadPage(a,["css/createMessage.css","css/webuploader.css","http://cdn.fuzeuser.com/plugins/datetimepicker/jquery.datetimepicker.css"],function(){var a={};$.extend(a,{data:{IssueParams:{type_id:"",question:"",happen_time:"",contact:"",pic:[]},delImgAlertParams:{content:"<p class='issueDelInfo'>确定要删除么？</p><p class='issueDelInfo'><a class='btn grey issueImgNoBtn' href='javascript:'>取消</a><a class='btn green issueImgDelBtn' href='javascript:'>确定</a></p>",width:300}},init:{initData:function(){a.post.postIssueTyle(),a.post.uploadImgs(),a.func.dateInit(),$("#submitMyIssue").on("click",a.func.submitMyIssue)}},post:{postIssueTyle:function(){Serve.getIssueTypeList("",function(a){200==a.code&&$("#issueTypeList").html($("#issueTypeTem").tmpl(a))})},uploadImgs:function(){require(["js/lib/webuploader.js"],function(b){var c=b.create({auto:!0,swf:"/js/lib/Uploader.swf",server:"/front.php?s=/Home/Kf/upload",pick:"#filePicker",accept:{title:"Images",extensions:"jpg,jpeg,bmp,png",mimeTypes:"image/*"},fileNumLimit:5});c.on("fileQueued",function(a){var b=$('<div id="'+a.id+'" class="file-item thumbnail"><img><span class="issueDel">x</span></div>'),d=b.find("img");$("#fileList").append(b),c.makeThumb(a,function(a,b){return a?void d.replaceWith("<span>不能预览</span>"):void d.attr("src",b)},120,120)}),c.on("uploadProgress",function(a,b){var c=$("#"+a.id),d=c.find(".wp_progress span");d.length||(d=$('<p class="wp_progress"><span></span></p>').appendTo(c).find("span")),d.css("width",100*b+"%")}),c.on("uploadSuccess",function(b,c){a.data.IssueParams.pic.push(c.path),$("#"+b.id).addClass("upload-state-done");var d=$("#fileList").find(".upload-state-done").size();d>=5?$(".cm-img-btn").hide():$(".cm-img-btn").show()}),c.on("uploadComplete",function(b){$("#"+b.id).find(".wp_progress").remove(),$("#"+b.id).on("click",".issueDel",function(){var d=$(this),e=d.parent(".upload-state-done"),f=$(".issueDel").index(d);$.alertPop(a.data.delImgAlertParams,function(){$(".issueImgNoBtn").on("click",function(){$(".pop_close").trigger("click")}),$(".issueImgDelBtn").on("click",function(){a.data.IssueParams.pic.splice(f,1),c.removeFile(b),e.remove(),$(".pop_close").trigger("click");var d=$("#fileList").find(".upload-state-done").size();d>=5?$(".cm-img-btn").hide():$(".cm-img-btn").show()})})})})})}},func:{submitMyIssue:function(){return a.data.IssueParams.type_id=$("#issueTypeList").val(),a.data.IssueParams.question=$("#issueTitle").val(),a.data.IssueParams.happen_time=$("#issueCreateTime").prop("value"),a.data.IssueParams.contact=$("#issueContact").val(),console.log(a.data.IssueParams),""==a.data.IssueParams.happen_time?void $.alertTmpMsg("请选择问题发生的时间哟！！"):""==a.data.IssueParams.contact?void $.alertTmpMsg("请输入您的联系方式哟！"):""==a.data.IssueParams.question?void $.alertTmpMsg("亲，您的问题呢！！"):$.checkMail(a.data.IssueParams.contact)||$.checkTel(a.data.IssueParams.contact)?void(null!=$.getCookie("username")&&""!=$.getCookie("username")?Serve.postIssue(a.data.IssueParams,function(a){console.log(a),200==a.code&&$.goPage("serviceCenter")}):$.alertTmpMsg("请先登录哦！")):void $.alertTmpMsg("请填写正确的联系方式哦！")},dateInit:function(){require(["http://cdn.fuzeuser.com/plugins/datetimepicker/jquery.datetimepicker.js"],function(){$("#issueCreateTime").datetimepicker(),$(".xdsoft_datetimepicker").hide()})}}}),a.init.initData()})}});