/*! touch 2016-11-04 */
define(function(){return function(templateUrl,param){$("#container").load(templateUrl,function(){function tmplProduct(a){function b(a){return a>=10?($.alertTmpMsg("单次购买商品数量不能超过10件。"),!1):!0}if(a=a?a:global_product,a.Goods)$.setTitle("战斧-"+a.Goods.title),$(".product-info").html($("#productInfoTemplate").tmpl(a)),tmplProduct(a.Goods);else{var c=a.type,d="";switch(c){case"color":d="#productColorTemplate";break;case"volume":d="#productVolumeTemplate";break;case"handle":d="#productHandleTemplate";break;default:d="#productVolumeTemplate"}var e=a.index=window["global_"+a.type]=a.data[window["global_"+a.type]]?window["global_"+a.type]:0;$(".prd_number").before($(d).tmpl(a));var f=a.data[e]?a.data[e]:a.data[0];if(f.son)tmplProduct(f.son);else{$(".picker").on("click",function(){window["global_"+$(this).data("type")]=$(this).data("index"),tmplProduct(global_product),tmplImages()}),window.g_a_obj=f,$(".origin_price span").text(f.price),$(".prd_price .price span").text(f.pre_price?f.pre_price:f.price);var g=f.pre_price?f.pre_price:f.price;$(".subtract").on("click",function(){var a=$(this).next().find(".count-input"),b=a.val();b>1&&(a.val(--b),$(".prd_price .price span").text((b*g).toFixed(2)))}),$(".plus").on("click",function(){var a=$(this).prev().find(".count-input"),c=a.val();b(c)&&(a.val(++c),$(".prd_price .price span").text((c*g).toFixed(2)))}),$(".count-input").on("input",function(){var a=$(this).val().replace(/[^0-9]/gi,"");a=parseInt(a)?a:1,b(a)||(a=10),$(this).val(a),$(".prd_price .price span").text((a*g).toFixed(2))}),$(".operate .buy_btn.ljgm").on("click",function(){var a=parseInt($(".prd_number .count-input").val());$.getCookie("username")?Cart.addCartFilter({cartlist:[{gid:global_product.Goods.gid,g_a_flag:g_a_obj.g_a_flag,g_num:a,flag:global_product.Goods.data[window["global_"+global_product.Goods.type]].flag}]},function(a){200==a.code?($.setNum(a.goods_num),Order.storeCartIds({ids:[{id:a.cart_ids[0]}]},function(a){200==a.code?$.goPage("#createOrder"):500310==a.code?$.alertTmpMsg(a.message):$.alertTmpMsg(a.message)})):500310==a.code?$.alertTmpMsg(a.message):$.alertTmpMsg(a.message)}):window.location.href=Links.login+"?redirect="+encodeURIComponent(location.href+"/"+a)+"&broker=fuzemall&l=zh-cn"}),$(".operate .buy_btn.jrdgwc").on("click",function(){var a=parseInt($(".prd_number .count-input").val());Cart.addCart({cartlist:[{gid:global_product.Goods.gid,g_a_flag:g_a_obj.g_a_flag,g_num:a,flag:global_product.Goods.data[window["global_"+global_product.Goods.type]].flag}]},function(a){if(200==a.code){var b={};b.content=$("#addCartPop").tmpl({}),b.width=450,$.setNum(a.data.goods_num),$.alertPop(b,function(){$(".pop_cancel").on("click",function(){$.closePop()}),$(".pop_ok").on("click",function(){$.closePop(),$.goPage("#cart")})})}else 500310==a.code?$.alertTmpMsg(a.message):$.alertTmpMsg(a.message)})})}}}function tmplImages(){var a=window["global_"+global_product.Goods.type]?window["global_"+global_product.Goods.type]:0,b=global_product.Goods.data[a];$(".large ul").html($("#largeTemplate").tmpl(b)),$(".thumbnail ul").html($("#thumbTemplate").tmpl(b))}$("body").on("click",".prd_zixun",function(){$("#zhichiBtn img").trigger("click")});var productDetail={hd:{html:"pages/productDetail-hd.html",css:["css/productDetail-hd.css"]},f1:{html:"pages/productDetail-f1.html",css:["css/productDetail-f1.css"]},f618:{html:"pages/productDetail-f1.html",css:["css/productDetail-f1.css"]}};Goods.getGoodsById({gid:param.itemId},function(data){function ShowCountDown(a,b){var c=new Date(data.Goods.now_time),d=new Date(a),e=d.getTime()-c.getTime(),f=parseInt(e/1e3),g=Math.floor(f/86400),h=Math.floor((f-24*g*60*60)/3600),i=Math.floor((f-24*g*60*60-3600*h)/60),j=Math.floor(f-24*g*60*60-3600*h-60*i),k=document.getElementById(b);k.innerHTML=g+"天"+h+":"+i+":"+j,0==e&&(clearInterval(timmer),$(".activity").hide(),$(".yuanshi").show()),data.Goods.now_time=new Date(data.Goods.now_time).getTime()+1e3}if(console.log(data),200==data.code){if(global_product=data,tmplImages(),tmplProduct(),$("#pdCon").load(eval("productDetail."+global_product.Goods.alias+".html"),function(){$.asynCss(eval("productDetail."+global_product.Goods.alias+".css"))}),1==data.Goods.is_promotion){var interval=1e3;timmer=setInterval(function(){ShowCountDown(data.Goods.promotion_etime,"time")},interval)}}else 500401==data.code?$.go404():$.alertTmpMsg(data.message)})})}});