/*! touch 2016-11-04 */
function IsPC(){for(var a=!0,b=navigator.userAgent,c=new Array("Android","iPhone","SymbianOS","Windows Phone","iPad","iPod"),d=0;d<c.length;d++)if(b.indexOf(c[d])>0){a=!1;break}return a}IsPC()&&(location.href="release.html"),$(function(){function a(a,b,c){a.src=b,a.load(),a.addEventListener("canplay",function(){m.loadStatus="loaded",c()}),a.addEventListener("loadstart",function(){m.loadStatus="loading"})}function b(){return"unload"===m.loadStatus?(a(m,"Adventure_Island_II-Overworld_3.mp3",function(){b()}),1):void m.play()}function c(){m.pause()}function d(){var a=$("#rf-name").val(),b=$("#rf-phone").val(),c=$("#rf-code").val();if(n.submit.name=a,n.submit.phone=b,n.submit.code=c,""==n.submit.name)return $(".rf-box").find("input").eq(0).parents(".rf-error-pa").next().text("姓名不能为空"),!1;if(""==n.submit.phone)return $(".rf-box").find("input").eq(1).parents(".rf-error-pa").next().text("手机号码不能为空"),!1;if(!e(n.submit.phone))return $(".rf-box").find("input").eq(1).parents(".rf-error-pa").next().text("请填写正确的手机号"),!1;if(""==n.submit.code)return $(".rf-box").find("input").eq(2).parents(".rf-error-pa").next().text("验证码不能为空"),!1;var d="param="+JSON.stringify(n.submit);$.ajax({type:"post",url:"/front.php?s=/Home/Book/submit",data:d,dataType:"json",success:function(a){200==a.code?(i("提交成功","如果您抽中入场券，我们将在</br>5月10日前电话联系您，请保持手机畅通。"),$("#rf-name").val(""),$("#rf-phone").val(""),$("#rf-code").val("")):i("提交失败",a.message)}})}function e(a){var b=/^(13[0-9]|14[0-9]|15[0-9]|18[0-9]|17[0-9])\d{8}$/i;return b.test(a)}function f(){if(!$(this).hasClass("rf-authSended")){o=60;var a=$("#rf-phone").val();if(n.authCode.phone=a,n.authCode.type=1,""==n.authCode.phone)return void $(".fr-error").eq(1).text("手机号码不能为空");if(!e(a))return void $(".fr-error").eq(1).text("请填写正确的手机号");$(".fr-error").eq(1).text("");var b="param="+JSON.stringify(n.authCode);$.ajax({type:"post",url:"/front.php?s=/Home/Book/getVerfiyCode",data:b,dataType:"json",success:function(a){200!=a.code&&i("提交失败",a.message)}}),g()}}function g(){$("#rf-authSend").html(o+" s").addClass("rf-authSended"),o--,0>o?$("#rf-authSend").html("发送验证码").removeClass("rf-authSended"):setTimeout(g,1e3)}function h(){var a=new BMap.Map("page-map"),b=new BMap.Point(116.50768,39.993112);a.centerAndZoom(b,17),a.addControl(new BMap.ZoomControl);var c=new BMap.Marker(new BMap.Point(116.50768,39.993112));a.addOverlay(c),a.panTo(116.50768,39.993112)}function i(a,b){$(".rl-min-pop").show(),$(".rl-min-pop").find("h1").text(a),$(".rl-min-pop").find("p").html(b)}function j(a){q.each(function(){return 0===this.height?(r=!1,!1):void 0}),r?(clearTimeout(p),a()):(r=!0,p=setTimeout(function(){j(a)},500))}var k=document.documentElement.clientWidth||document.body.clientWidth||document.body.scrollWidth,l=document.documentElement.clientHeight||document.body.clientHeight||document.body.scrollHeight;$(".min-container").height(l);var m=new Audio;m.loadStatus="unload",m.loop=!0,m.addEventListener("playing",function(a){$("#music").addClass("rotate")}),m.addEventListener("pause",function(a){$("#music").removeClass("rotate")}),$("body").one("touchend",function(){b(),$("#music").on("touchend",function(a){return m.paused?(b(),0):(c(),1)})}),window.onload=function(){"unload"===m.loadStatus&&b()},k/l>.6&&$(".page3 img,.page1 img").css({width:"90%"}),$(window).resize(function(){console.log(1);var a=document.documentElement.clientHeight||document.body.clientHeight||document.body.scrollHeight;$(".min-container").height(a),$(".page6-map").height(a)}),$(".min-fullpage").fullpage({menu:".min-fullpage",page:".page",start:0,duration:500,drag:!1,loop:!1,dir:"v",der:"0.25",afterChange:function(a){$(".page").find(".js-animate").each(function(){$(this).removeClass($(this).data("animate"))}),$(".page").eq(a.cur).find(".js-animate").each(function(){$(this).addClass($(this).data("animate"))})}});var n={authCode:{phone:"",type:1},submit:{phone:"",name:"",code:""}};$("#rf-Send").on("touchend",d);var o=60;$("#rf-authSend").on("touchend",f),$.getJSON("/front.php?s=/Book/currentTimestamp",function(a){function b(){e._Date=parseInt(g/86400);var a=g-24*e._Date*60*60;e._Hours=parseInt(a/3600);var b=a-60*e._Hours*60;e._Minutes=parseInt(b/60),e._Seconds=parseInt(b-60*e._Minutes),$("#rc-day").text(e._Date),$("#rc-hour").text(e._Hours),$("#rc-min").text(e._Minutes),$("#rc-sec").text(e._Seconds),g--,c()}function c(){g>-1?f=setTimeout(b,1e3):(clearTimeout(f),d())}function d(){}var e={};if(200==a.code){var f,g=a.timestamp;b()}}),$(".page6-map").height(l),h(),$("#map-click").on("touchend",function(){h()}),$(".rf-box").find("input").on("blur",function(){var a=!0,b=$(this).val(),c=$(this).siblings().text();""==b?($(this).parents(".rf-error-pa").next().text(c+"不能为空"),a=!1):$(this).parents(".rf-error-pa").next().text("");var d=$(".rf-box").find("input").index($(this));1==d&&a&&(e(b)||$(this).parents(".rf-error-pa").next().text("请填写正确的手机号"))}),$(".page6-cover").on("touchend",function(){$(this).hide()}),$("body").on("touchend",".rl-min-close,.rl-min-close-btn",function(){var a=$(".rl-min-pop").find("h1").text();"提交成功"==a&&($.fn.fullpage.moveNext(),o=-1),$(".rl-min-pop").hide(),$(".rl-min-pop").find("p").text("")});var p,q=$(".page1").find("img"),r=!0;j(function(){for(var a=q.size(),b=0;a>b;b++){var c=(q.eq(b).width(),q.eq(b).height());if(l>c){var d=(l-c)/2;q.eq(b).css({"margin-top":d+"px"})}}})});