/*! touch 2016-11-04 */
define(function(){return function(a,b){$("#container").loadPage(a,["css/gameItem.css","css/video-js.css"],function(){function a(a,b){Game.addGameCart({cartList:[{gid:a.data("gid"),productCode:a.data("produceid")?a.data("produceid"):0,type:a.data("type")}]},function(c){200==c.code?(0==c.data.exist?b&&b(c.data):($.alertTmpMsg("该商品已存在购物车。"),a.addClass("disable")),b&&b(c.data)):$.alertTmpMsg(c.message)})}function c(a,b){function c(a,b){0==b?$("#gs_prev").css("visibility","hidden"):$("#gs_prev").css("visibility","visible"),a>5&&b+1!=a?$("#gs_next").css("visibility","visible"):$("#gs_next").css("visibility","hidden")}function f(a,b,c){"next"==c&&e==b+1-5&&(++e,$(".ulwrap ul").css("margin-left",189.6*-e)),"prev"==c&&e==b&&(--e,$(".ulwrap ul").css("margin-left",189.6*-e))}var g=$(".ulwrap li"),h=$(".ulwrap li.active"),i=$(".ulwrap li.active").data("index");"prev"==a?i>0&&(g.eq(i-1).addClass("active"),h.removeClass("active"),$(".gs_big img").attr("src",g.eq(i-1).data("src")),i-1==0?$("#gs_prev").css("visibility","hidden"):$("#gs_prev").css("visibility","visible"),c(b,i-1),f(b,i,"prev"),d(g.eq(i-1).data("type"))):"next"==a&&b-1>i&&(g.eq(i+1).addClass("active"),h.removeClass("active"),$(".gs_big img").attr("src",g.eq(i+1).data("src")),c(b,i+1),f(b,i,"next"),d(g.eq(i+1).data("type")))}function d(a){$("#video").hide().attr("src",""),1==a?$(".video_mask").hide():2==a&&$(".video_mask").show()}var e=0;Game.getGameDetail({gid:b.itemId},function(a){200==a.code?($.setTitle("战斧游戏-"+a.Goods.title),$(".gameItem_wrap").css("background-image","url('"+a.Goods.bgImage+"')"),$(".gc_wrap").html($("#gameDetailTemplate").tmpl(a.Goods)),Game.gameResInfo({gid:b.itemId},function(a){$(".gameItem_slide_wrap").html($("#gameResTemplate").tmpl({list:a.list}));var b=a.list.length;5>=b&&$("#gs_next").css("visibility","hidden"),$(".gs_thumb ul").width(187.6*b+2*(b+1)),$(".gs_thumb ul li").on("click",function(){$(".gs_big img").attr("src",$(this).data("src")),$(".ulwrap ul li.active").removeClass("active"),$(this).addClass("active")}),$("#gs_prev").on("click",function(){c("prev",b)}),$("#gs_next").on("click",function(){c("next",b)}),$(".ulwrap li").on("click",function(){$(".ulwrap li.active").removeClass("active"),$(this).addClass("active"),$(".gs_big img").attr("src",$(this).data("src")),d($(this).data("type"))}),$(".video_mask").on("click",function(b){$("#video").attr("src")?navigator.userAgent.indexOf("Firefox")>0||($("#video")[0].paused?$("#video")[0].play():$("#video")[0].pause()):$("#video").show().attr("src",a.list[0].playUrl)})}),Game.gameProp({gid:b.itemId},function(a){a.data.gid=b.itemId,$(".gameItem_dlc").html($("#gameDlcTemplate").tmpl({list:a.data.dlclist}))})):500401==a.code?$.go404():$.alertTmpMsg(a.message)}),Game.getGameRecommend(null,function(a){200==a.code?($(".gt_content").html($("#reGameTemplate").tmpl({list:a.list.slice(0,4)})),$(".gt_content li").on("click",function(){$.goPage("#gameItem/"+$(this).data("id"))})):$.alertTmpMsg(a.message)}),$(".centered").on("click",".goto_money",function(){a($(this),function(a){1!=a.exist&&$.setNum(a.goods_num),$.goPage("#cart")})}),$(".centered").on("click",".set_cart",function(){var b=$(this);b.hasClass("disable")||a($(this),function(a){$.setNum(a.goods_num);var b={};b.content=$("#addCartPop").tmpl({}),b.width=450,$.alertPop(b,function(){$(".pop_cancel").on("click",function(){$.closePop()}),$(".pop_ok").on("click",function(){$.closePop(),$.goPage("#cart")})})})}),$(".search").on("click",function(){search_keyword=$.trim($(".game_toptit input").val()),window.location.href="#gameList"})})}});