/*! touch 2016-09-13 */
define(function(){return function(a,b){$("#container").loadPage(a,["css/createOrder.css"],function(){Order.getSelectCart(null,function(a){function b(a){0==a.length?($(".cart-address-more").hide(),$(".cart-address-no").show()):1==a.length?($(".cart-address-more").hide(),$(".cart-address-no").hide()):($(".cart-address-more").show(),$(".cart-address-no").hide())}if(0==a.data.list.length&&0==a.g_data.list.length)return $.goPage("#cart"),!1;var c,d,e,f=0,g=0;if(0==a.data.list.length?$(".cart-consignee").hide():$(".cart-consignee").show(),a.data.list.length){f=(100*f+100*a.data.total_price+100*a.data.shipping_price)/100,g=(100*g+100*a.data.shipping_price)/100,$("#_zjpj").html($("#zjpjTemplate").tmpl(a.data));var h=0,i={down:"更多地址	&or;",up:"收起地址	&and;"};Center.getAddressList(null,function(a){c=0==a.list.length?"":a.list[0].id,b(a.list);for(var f=a.list,g=0;g<f.length;g++)1==f[g].address_default&&(d=f[g].address_province+" "+f[g].address_city+" "+f[g].address_region+" "+f[g].address_detail,e=f[g].address_name+" "+f[g].address_phone);$(".cart-total-address").text(d),$(".cart-total-name").text(e),$(".tab_trueaddress").html($("#addressTemplate").tmpl(a)),$(".centered").on("click",".cart-address-tit",function(){var a=$(this),b=a.parent().find(".cad-detail").html(),c=a.parent().find(".cad-name").html()+" "+a.parent().find(".cad-tel").html();$(".cart-total-address").text(b),$(".cart-total-name").text(c),$(".cart-address-tit.active").removeClass("active"),$(this).addClass("active")}),0==$(".cart-address-tit.active").size()&&($(".cart-address-tit").eq(0).parent().show(),$(".cart-address-tit").eq(0).trigger("click")),$(".centered").on("click",".cart-address-edit",function(){$.cancelBubble();var a=$(this),b=(a.siblings(".cart-address-tit"),$(".cart-address-tit.active").attr("data-id"));h=a.data("index"),require(["js/modules/address.manage"+_min],function(c){Center.getAddressById({id:a.data("id")},function(a){200==a.code?c.editAddress(a,function(a){$(".tab_trueaddress").html($("#addressTemplate").tmpl(a));var c=$("#cart-address-"+a.list[0].id).find(".cart-address-tit");c.hasClass("active")&&c.trigger("click"),"up"==$(".cart-address-more a").attr("cart-data")&&$(".tab_trueaddress li").show(),$(".cart-address-tit[data-id="+b+"]").trigger("click")}):$.alertTmpMsg(a.message)})})}),$(".centered").on("click",".cart-address-set",function(){var a=$(this),b=a.siblings(".cart-address-detail"),c=b.find(".cad-name").html(),d=b.find(".cad-detail").html().split(" "),e=b.find(".cad-tel").html(),f={};f.address_name=c,f.address_province=d[0],f.address_city=d[1],f.address_region=d[2],f.address_detail=d[3],f.address_phone=e,f.address_default=1,Center.editAddress({id:$(this).data("id"),data:f},function(b){"200"==b.code&&($(".cart-address-default").addClass("hidden"),$(".cart-address-set").removeClass("hidden"),a.siblings(".cart-address-default").removeClass("hidden"),a.addClass("hidden"),a.siblings(".cart-address-tit").trigger("click"))})}),$(".cart-address-more").on("click","a",function(){var a=$(this),b=a.attr("cart-data");"down"==b?($(".cart-address-list li").show(),a.html(i.up).attr("cart-data","up")):($(".cart-address-list li").hide(),$(".cart-address-list .cart-address-tit.active").parent().show(),a.html(i.down).attr("cart-data","down"))}),$(".address_btn a.cart-add-address").on("click",function(){return $(".tab_trueaddress li").length>8?void $.alertTmpMsg("最多可以有8个收货地址。"):($.get("front.php?s=/Home/Stat/stat",{type:"address_pv"}),void require(["js/modules/address.manage"+_min],function(a){a.addAddress(function(a){$(".tab_trueaddress").html($("#addressTemplate").tmpl(a)),$(".cart-address-tit.active").removeClass("active"),c==a.list[0].id?$(".cart-address-tit").eq(1).trigger("click"):($(".cart-address-tit").eq(0).trigger("click"),c=a.list[0].id),b(a.list),"down"==$(".cart-address-more a").attr("cart-data")?$(".cart-address-more a").trigger("click"):$(".tab_trueaddress li").show()})}))}),$(".centered").on("click",".cart-address-del",function(){var a={};a.title="删除",a.content=$("#deleteWarnTemplate").tmpl({msg:"您确认要删除这个地址吗？",ok:"删除"}),a.width=500;var c=$(this);$.alertPop(a,function(){$(".dl_cancel").on("click",function(){$("#global_pop").hide()}),$(".dl_ok").on("click",function(){Center.deleteAddress({id:c.data("id")},function(a){$("#global_pop").hide(),200==a.code?($("#cart-address-"+c.data("id")).remove(),$(".cart-address-tit.active").size()<1&&$(".cart-address-tit").first().addClass("active"),b(a.list),0==$(".cart-address-tit.active").size()&&($(".cart-address-tit").eq(0).parent().show(),$(".cart-address-tit").eq(0).trigger("click")),$(".cart-address-list li").eq(0).show(),1==$(".cart-address-tit").size()&&($(".cart-address-more").hide(),$(".cart-address-list li").show())):$.alertTmpMsg(a.message)})})})})}),$("body").on("click",".fp_type input[type=radio]",function(){if($(".order_textbox").val(""),2==$(this).data("type")){var a=$(".cate_type input[type=radio]:checked");1==a.data("type")&&$(".order_inptext").show()}else $(".order_inptext").hide()}),$("body").on("click",".cate_type input[type=radio]",function(){if($(".order_textbox").val(""),4==$(this).data("type"))$(".order_inptext").hide();else{var a=$(".fp_type input[type=radio]:checked");2==a.data("type")&&$(".order_inptext").show()}}),$(".cart-add-bill").on("click",function(){$.get("front.php?s=/Home/Stat/stat",{type:"invoice_pv"});var a={};a.title="发票信息",a.content=$("#billTemplate").tmpl(),a.width=400,$.alertPop(a,function(){var a=!0;$(".bill-error").hide(),$(".dl_cancel").on("click",function(){$("#global_pop").hide()}),$(".order-save").on("click","a",function(){for(var b="普通发票（纸质） ",c=$(".fp_type").find("input[type=radio]"),d=$(".cate_type").find("input[type=radio]"),e=0;e<c.length;e++)if(c.eq(e).prop("checked"))if(1==e){var f=$.trim($(".order_textbox").val());if(""==f&&4!=$(".cate_type").find("input[type=radio]:checked").data("type"))$(".bill-error").html("请填写公司抬头").show(),a=!1;else if($.checkIllegalChar(f)){a=!0;var g=$(".order_textbox").val();b+=g}else $(".bill-error").html("公司抬头不能含有非法字符").show(),a=!1}else a=!0,b+=c.eq(e).val();if(a){for(var e=0;e<d.length;e++)d.eq(e).prop("checked")&&(b+=" "+d.eq(e).val());$(".cart-bill-detail").html(b).attr("invoice-type",1),$("#global_pop").hide()}})})})}a.g_data.list.length&&(f=(100*f+100*a.g_data.total_price)/100,g=(100*g+100*a.g_data.shipping_price)/100,$("#_yxdj").html($("#yxdjTemplate").tmpl(a.g_data))),$(".cart-freight").text(g.toFixed(2)),$(".cart-total-cost").text(f.toFixed(2)),$(".sum_cart .btn").on("click",function(){var b="",c={};if(a.data.list.length){if(0==$(".cart-address-tit.active").length)return $.alertTmpMsg("请选择收货地址"),!1;b=$(".cart-address-tit.active").data("id"),c.address_id=b}c.is_invoice=0,1==$(".cart-bill-detail").attr("invoice-type")&&(c.is_invoice=1,c.invoice_notice=$(".order_textbox").val(),c.invoice_type=$(".fp_type input[type='radio']:checked").data("type"),c.invoice_content=$(".cate_type input[type='radio']:checked").data("type")),Order.submitOrder(c,function(a){200==a.code?($.setNum(a.data.goods_num),$.goPage("#pay/"+a.data.order_id)):$.alertTmpMsg(a.message)})})})})}});